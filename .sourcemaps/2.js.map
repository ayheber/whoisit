{"version":3,"sources":["../../src/pages/lobby/lobby.module.ts","../../src/pages/lobby/lobby.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LobbyPage } from './lobby';\n\n@NgModule({\n  declarations: [\n    LobbyPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LobbyPage),\n  ],\n})\nexport class LobbyPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/lobby/lobby.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { Observable } from 'rxjs/Observable';\nimport { UserModel } from '../../Models/user.model';\nimport { RoomModel } from '../../Models/room.model';\nimport { Platform } from 'ionic-angular';\nimport { AlertController } from 'ionic-angular';\nimport { AuthService } from '../../services/auth.service'\nimport { RoomsService } from '../../services/rooms.service';\n\n@IonicPage()\n@Component({\n  selector: 'page-lobby',\n  templateUrl: 'lobby.html'\n})\nexport class LobbyPage {\n\n  roomKey: string;\n  roomsItems: Observable<RoomModel>;\n  users: Observable<UserModel[]>;\n  isOwner: Boolean;\n  selectorUser: string; \n  spyUser: string;\n  roomName: string;\n  entryCode: string;\n  usersInRoomKey: string;\n  usersModel: UserModel[] = [];\n  usersCount: number;\n\n  constructor(private platform: Platform, public navCtrl: NavController, public navParams: NavParams, \n              public af: AngularFireDatabase, private alertCtrl: AlertController, private authService: AuthService,\n              private roomService: RoomsService) {\n                \n          \n    // Get thr paramters from the navigation controller\n    this.roomKey = this.navParams.get('roomKey');\n\n\n    \n    // get the users in the current room\n    af.list(`rooms/${this.roomKey}/users`).subscribe( snapshots => {\n      this.usersModel = [];\n      this.usersCount = snapshots.length;\n      snapshots.forEach( snapshot=> {\n        let userId = snapshot.$key;\n        let points = snapshot.$value;\n        \n        af.object(`users/${userId}`).subscribe( t=> {\n          t.pointsInRoom = points;\n          this.usersModel.push(t);\n        });\n      });\n    });\n\n    // Get the current room\n    af.object(`/rooms/${this.roomKey}`).subscribe( t=> {\n      this.roomName = t.roomName;\n      if(t.owner == authService.currentUser.displayName)\n          this.isOwner = true;\n      else {\n          this.roomService.updateUsersInRoom(this.roomKey);      \n      }\n\n          this.entryCode = t.entryCode;\n    })\n    \n    \n\n    // wait till the selector will select a category\n    af.object(`rooms/${this.roomKey}/isStarted`).subscribe( t=> {\n      if(t.$value) {\n          this.af.object(`rooms/${this.roomKey}/selector`).subscribe(  selector => {\n            if(selector.$value == authService.currentUser.displayName) {\n              this.navCtrl.push('ChooseCategoryPage', {\n                roomKey: this.roomKey,\n                spy: this.spyUser\n              });\n            }\n            else{\n              af.object(`rooms/${this.roomKey}/isCategorySelected`).subscribe(catSelected => {\n              if(catSelected.$value) {\n                // if(this.selectorUser == authService.currentUser.$key) {\n                  // go to the loading game...\n                  this.navCtrl.push('GamePage', {\n                    roomKey: this.roomKey,\n                    roundKey: this.selectorUser\n                }\n            );\n            }\n            });\n          }\n          // else {\n            \n            // }\n          // }\n        });\n      }\n    });\n  }\n    \n  private raffleSpy(){ \n     let spyRandNumber = Math.floor(Math.random() * (this.usersModel.length - 1) );\n\n     if(spyRandNumber >= this.usersModel.length)\n      spyRandNumber = this.usersModel.length - 1;\n     this.spyUser = this.usersModel[spyRandNumber].$key;\n     //this.af.object(`/rooms/${this.roomKey}/spy`).set(this.spyUser);\n     this.roomService.setSpy(this.spyUser);\n  }\n\n  private raffleSelector(){ \n    let spyRandNumber = Math.floor(Math.random() * (this.usersModel.length - 1));\n    if(spyRandNumber >= this.usersModel.length)\n      spyRandNumber = this.usersModel.length - 1;\n\n    this.selectorUser = this.usersModel[spyRandNumber].displayName;\n    this.af.object(`/rooms/${this.roomKey}/selector`).set(this.selectorUser);\n  }\n\n  startGame() {\n      \n      this.roomService.updateUsersInRoom(this.roomKey);\n\n      // raffle spy and category selector  \n      this.raffleSelector(); \n      this.raffleSpy();\n     \n\n      // Add new room to the db\n       this.af.object(`rooms/${this.roomKey}/isStarted`).set(true);\n       this.af.object(`rooms/${this.roomKey}/usersCount`).set(this.usersCount);\n  \n  }\n\n  private getUserPoints(user: UserModel) {\n    this.af.object(`/rooms/${this.roomKey}/users/${user.$key}`).subscribe(t=> {\n      console.log(\"return value \" + t.$value);\n      return t.$value;\n    });\n  }\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/lobby/lobby.ts"],"sourceRoot":""}