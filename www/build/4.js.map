{"version":3,"sources":["../../src/pages/end-game/end-game.module.ts","../../src/pages/end-game/end-game.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAyC;AACO;AACP;AAUzC,IAAa,iBAAiB;IAA9B;IAAgC,CAAC;IAAD,wBAAC;AAAD,CAAC;AAApB,iBAAiB;IAR7B,uEAAQ,CAAC;QACR,YAAY,EAAE;YACZ,8DAAW;SACZ;QACD,OAAO,EAAE;YACP,sEAAe,CAAC,QAAQ,CAAC,8DAAW,CAAC;SACtC;KACF,CAAC;GACW,iBAAiB,CAAG;AAAH;;;;;;;;;;;;;;;;;;;;;;;;ACZY;AAC0B;AACR;AAGA;AACF;AACR;AAOlD,IAAa,WAAW;IAQtB,qBAAmB,OAAsB,EAAS,SAAoB,EAAU,EAAuB,EACpF,WAAyB,EAAS,IAAiB,EAAS,WAA8B;QAD7G,iBA4FD;QA5FoB,YAAO,GAAP,OAAO,CAAe;QAAS,cAAS,GAAT,SAAS,CAAW;QAAU,OAAE,GAAF,EAAE,CAAqB;QACpF,gBAAW,GAAX,WAAW,CAAc;QAAS,SAAI,GAAJ,IAAI,CAAa;QAAS,gBAAW,GAAX,WAAW,CAAmB;QAJ7G,eAAU,GAAgB,EAAE,CAAC;QAKf,OAAO,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAC;QACrD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAC7C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAE/C,EAAE,EAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,YAAU,IAAI,CAAC,QAAQ,gBAAa,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAC5D,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,YAAU,IAAI,CAAC,QAAQ,iBAAc,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACtE,CAAC;QACD,IAAI,CAAC,CAAC;YACJ,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,SAAS,CAAE,WAAC;gBAClC,CAAC,CAAC,OAAO,CAAE,cAAI;oBACb,EAAE,EAAC,IAAI,CAAC,OAAO,IAAI,KAAI,CAAC,OAAO,CAAC,EAAC;wBAC/B,KAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC;wBACzB,MAAM,CAAC;oBACT,CAAC;gBACH,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;QACL,CAAC;QAED,mCAAmC;QACnC,IAAI,CAAC,UAAU,GAAG,WAAW,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAC3E,EAAE,EAAC,WAAW,CAAC,MAAM,EAAE,IAAK,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC;YAEvD,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACrB,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC3B,CAAC;QAED,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QACrB,gCAAgC;QAChC,EAAE,CAAC,MAAM,CAAC,YAAU,IAAI,CAAC,QAAQ,gBAAa,CAAC,CAAC,SAAS,CAAE,WAAC;YACxD,kBAAkB;YACnB,EAAE,EAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;gBACZ,wBAAwB;gBACvB,EAAE,EAAC,KAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,IAAI,KAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;oBAC3D,KAAI,CAAC,oBAAoB,EAAE,CAAC;oBAC5B,EAAE,CAAC,MAAM,CAAC,aAAW,KAAI,CAAC,QAAQ,cAAW,CAAC,CAAC,SAAS,CAAE,aAAG;wBAC3D,EAAE,EAAC,GAAG,CAAC,MAAM,IAAI,IAAI,CAAC,EAAC;4BACrB,MAAM,CAAC;wBACT,CAAC;wBAED,uBAAuB;wBACvB,EAAE,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;4BACd,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE;gCACvB,QAAQ,EAAE,KAAI,CAAC,QAAQ;gCACvB,OAAO,EAAE,KAAI,CAAC,OAAO;6BAC5B,CAAC,CAAC;wBACL,CAAC;wBACD,IAAI,EAAC;4BACH,EAAE,CAAC,MAAM,CAAC,YAAU,KAAI,CAAC,QAAQ,MAAG,CAAC,CAAC,SAAS,CAAC,aAAG;gCAE3C,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE;oCAC7B,QAAQ,EAAE,GAAG,CAAC,YAAY;oCAC1B,MAAM,EAAG,GAAG,CAAC,MAAM;oCACnB,QAAQ,EAAE,KAAI,CAAC,QAAQ;iCAChC,CAAC;4BAAA,CAAC,CAAC,CAAC;wBACP,CAAC;oBACH,CAAC,CAAC,CAAC;gBACL,CAAC;gBACD,IAAI,CAAC,CAAC;oBAEJ,EAAE,CAAC,MAAM,CAAC,aAAW,KAAI,CAAC,QAAQ,cAAW,CAAC,CAAC,SAAS,CAAE,aAAG;wBAE3D,0CAA0C;wBAC1C,EAAE,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;4BACd,KAAI,CAAC,oBAAoB,EAAE,CAAC;4BAC5B,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;4BAChC,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE;gCACrB,QAAQ,EAAE,KAAI,CAAC,QAAQ;gCACvB,OAAO,EAAE,KAAI,CAAC,OAAO;6BAC1B,CAAC,CAAC;wBACT,CAAC;wBACD,IAAI,CAAC,CAAC;4BACN,KAAI,CAAC,EAAE,CAAC,MAAM,CAAC,YAAU,KAAI,CAAC,QAAQ,gBAAa,CAAC,CAAC,SAAS,CAAE,eAAK;gCAEjE,EAAE,EAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;oCAChB,KAAI,CAAC,oBAAoB,EAAE,CAAC;oCAAA,CAAC;oCAC7B,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;oCAChC,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE;wCACvB,QAAQ,EAAE,KAAI,CAAC,QAAQ;wCACvB,OAAO,EAAE,KAAI,CAAC,OAAO;qCAC1B,CAAC,CAAC;gCACP,CAAC;4BACH,CAAC,CAAC,CAAC;wBACL,CAAC;oBACH,CAAC,CAAC,CAAC;gBAEL,CAAC;YACJ,CAAC;QAEJ,CAAC,CAAC,CAAC;IACT,CAAC;IAED,uCAAiB,GAAjB;QACI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpC,OAAO,EAAE,+BAA+B;SACzC,CAAC,CAAC;QACH,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;IACxB,CAAC;IAED,yCAAmB,GAAnB;QACE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACpC,OAAO,EAAE,+BAA+B;SACzC,CAAC,CAAC;QACH,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;IACxB,CAAC;IAMO,0CAAoB,GAA5B;QACE,EAAE,EAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC;YACrB,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;IAC1B,CAAC;IAED,gCAAU,GAAV,UAAW,IAAe;QAA1B,iBA2BC;QAvBC,IAAI,OAAO,GAAG,CAAC,CAAC;QAChB,IAAI,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,aAAW,IAAI,CAAC,QAAQ,eAAU,IAAI,CAAC,IAAM,CAAC,CAAC,SAAS,CAAC,WAAC;YAC1F,OAAO,GAAG,CAAC,CAAC,MAAM,CAAC;YACnB,EAAE,EAAC,YAAY,IAAI,IAAI,CAAC;gBACtB,YAAY,CAAC,WAAW,EAAE,CAAC;YAC7B,OAAO,EAAE,CAAC;YACV,KAAI,CAAC,EAAE,CAAC,MAAM,CAAC,aAAW,KAAI,CAAC,QAAQ,eAAU,IAAI,CAAC,IAAM,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAC7E,CAAC,CAAC,CAAC;QACH,EAAE,EAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;YAC1C,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,IAAI,CAAC,CAAC;YAExC,4CAA4C;YAC5C,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,aAAW,IAAI,CAAC,QAAQ,WAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QAClF,CAAC;QACD,IAAI,CAAC,CAAC;YACJ,6CAA6C;YAC7C,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,aAAW,IAAI,CAAC,QAAQ,YAAS,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QACnF,CAAC;QAED,iDAAiD;QACjD,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,YAAU,IAAI,CAAC,OAAO,eAAU,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAM,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;QAErH,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IACH,kBAAC;AAAD,CAAC;AAzJY,WAAW;IALvB,wEAAS,EAAE;IACX,wEAAS,CAAC;QACT,QAAQ,EAAE,eAAe;OACG;KAC7B,CAAC;4OAS6D,EAA0C;QACvE,QAA6E;AAgJ9G;SAzJY,WAAW,gB","file":"4.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { EndGamePage } from './end-game';\n\n@NgModule({\n  declarations: [\n    EndGamePage,\n  ],\n  imports: [\n    IonicPageModule.forChild(EndGamePage),\n  ],\n})\nexport class EndGamePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/end-game/end-game.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { UserModel } from '../../Models/user.model';\nimport { RoundModel } from '../../Models/round.model';\nimport { RoomsService } from '../../services/rooms.service';\nimport { AuthService } from '../../services/auth.service';\nimport { LoadingController } from 'ionic-angular';\n\n@IonicPage()\n@Component({\n  selector: 'page-end-game',\n  templateUrl: 'end-game.html',\n})\nexport class EndGamePage {\n\n  loader: any;\n  spyReadyToVote: boolean;\n  isTheSpy: boolean;\n  usersModel: UserModel[] = [];\n  roomKey: string;\n  roundKey: string;\n  constructor(public navCtrl: NavController, public navParams: NavParams,  public af: AngularFireDatabase,\n              public roomService: RoomsService, public auth: AuthService, public loadingCtrl: LoadingController) {\n                console.log(\"enter to ctor of end-game\");\n    this.roomKey = this.navParams.get('roomKey');\n    this.roundKey = this.navParams.get('roundKey');\n\n    if(this.roundKey != null) {\n          this.af.object(`rounds/${this.roundKey}/votesCount`).set(0);\n          this.af.object(`rounds/${this.roundKey}/votes/dummy`).set(true);\n    } \n    else {\n      this.af.list(`rounds/`).subscribe( t=> {\n        t.forEach( room => {\n          if(room.roomKey == this.roomKey){\n            this.roomKey = room.$key;\n            return;\n          }\n        });\n      });\n    }\n\n    // get all of the users in the room\n    this.usersModel = roomService.getUsersFromRoomButme(this.auth.currentUser);\n    if(roomService.getSpy() ==  this.auth.currentUser.$key) {\n    \n      this.isTheSpy = true;\n      this.presentLoadingSpy();\n    }\n\n    console.log(\"loading\");\n      // wait till all users will vote\n      af.object(`rounds/${this.roundKey}/isAllVoted`).subscribe( t=> {\n          // all users voted\n         if(t.$value) {\n           // check if i am the spy\n            if(this.auth.currentUser.$key == this.roomService.getSpy()) {\n              this.dismissLoadingPlayer();\n              af.object(`/rounds/${this.roundKey}/isSpyWon`).subscribe( spy=> {\n                if(spy.$value == null){\n                  return;\n                }\n                \n                // check if the spy won\n                if(spy.$value) {\n                  this.navCtrl.push('ScorePage', {\n                          roundKey: this.roundKey,\n                          roomKey: this.roomKey\n                  });\n                }\n                else{ // spy lose\n                  af.object(`rounds/${this.roundKey}/`).subscribe(cat =>{\n                    \n                          this.navCtrl.push('GuessPage', {\n                            category: cat.categoryName,\n                            secret:  cat.secret,\n                            roundKey: this.roundKey\n                  })});\n                }\n              });\n            }\n            else { // i am not the spy\n\n              af.object(`/rounds/${this.roundKey}/isSpyWon`).subscribe( spy=> {\n                \n                // if the spy won so we move to score page\n                if(spy.$value) {\n                  this.dismissLoadingPlayer();\n                  console.log(\"go to score page\");\n                  this.navCtrl.push('ScorePage', {\n                            roundKey: this.roundKey,\n                            roomKey: this.roomKey\n                      });\n                }\n                else {\n                this.af.object(`rounds/${this.roundKey}/isSpyGuess`).subscribe( guess => {\n\n                    if(guess.$value) {\n                      this.dismissLoadingPlayer();;\n                      console.log(\"go to score page\");\n                      this.navCtrl.push('ScorePage', {\n                              roundKey: this.roundKey,\n                              roomKey: this.roomKey\n                        });\n                    }\n                  });\n                }\n              });\n              \n            }\n         }\n  \n      });\n}\n\npresentLoadingSpy() {\n    this.loader = this.loadingCtrl.create({\n      content: \"Wait till all players vote...\",\n    });\n    this.loader.present();\n  }\n\n  presentLoadinPlayer() {\n    this.loader = this.loadingCtrl.create({\n      content: \"Wait till all players vote...\",\n    });\n    this.loader.present();\n  }\n\n\n\n\n\n  private dismissLoadingPlayer(){\n    if(this.loader != null)\n      this.loader.dismiss();\n  }\n\n  selectUser(user: UserModel) {\n\n    \n    \n    let counter = 0;  \n    let subscribtion = this.af.object(`/rounds/${this.roundKey}/votes/${user.$key}`).subscribe(u => {\n      counter = u.$value;\n      if(subscribtion != null)\n        subscribtion.unsubscribe();\n      counter++;\n      this.af.object(`/rounds/${this.roundKey}/votes/${user.$key}`).set(counter);\n    });\n    if(user.$key == this.roomService.getSpy()) {\n      this.auth.currentUser.pointsInRoom += 2;\n\n      // add the current user to the win user list\n      this.af.list(`/rounds/${this.roundKey}/wins/`).push(this.auth.currentUser.$key);\n    }\n    else {\n      // add the current user to the lose user list\n      this.af.list(`/rounds/${this.roundKey}/loses/`).push(this.auth.currentUser.$key);\n    }\n\n    // in case you find the real spy you get 3 points\n    this.af.object(`/rooms/${this.roomKey}/users/${this.auth.currentUser.$key}`).set(this.auth.currentUser.pointsInRoom);\n\n    this.presentLoadinPlayer();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/end-game/end-game.ts"],"sourceRoot":""}