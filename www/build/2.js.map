{"version":3,"sources":["../../src/pages/lobby/lobby.module.ts","../../src/pages/lobby/lobby.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LobbyPage } from './lobby';\n\n@NgModule({\n  declarations: [\n    LobbyPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LobbyPage),\n  ],\n})\nexport class LobbyPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/lobby/lobby.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { Observable } from 'rxjs/Observable';\nimport { UserModel } from '../../Models/user.model';\nimport { RoomModel } from '../../Models/room.model';\nimport { Platform } from 'ionic-angular';\nimport { AlertController } from 'ionic-angular';\nimport { AuthService } from '../../services/auth.service'\nimport { RoomsService } from '../../services/rooms.service';\nimport { RoundModel } from '../../Models/round.model';\nimport { LoadingController } from 'ionic-angular';\n\n@IonicPage()\n@Component({\n  selector: 'page-lobby',\n  templateUrl: 'lobby.html'\n})\nexport class LobbyPage {\n\n  roomKey: string;\n  roomsItems: Observable<RoomModel>;\n  users: Observable<UserModel[]>;\n  isOwner: Boolean;\n  selectorUser: string; \n  spyUser: string;\n  roomName: string;\n  entryCode: string;\n  usersInRoomKey: string;\n  usersModel: UserModel[] = [];\n  usersCount: number;\n  loader: any;\n\n  constructor(private platform: Platform, public navCtrl: NavController, public navParams: NavParams, \n              public af: AngularFireDatabase, private alertCtrl: AlertController, private authService: AuthService,\n              private roomService: RoomsService, public loadingCtrl: LoadingController) {\n                \n    console.log(\"enter to lobby ctor\");\n    // Get thr paramters from the navigation controller\n    this.roomKey = this.navParams.get('roomKey');\n\n\n    \n    // get the users in the current room\n    af.list(`rooms/${this.roomKey}/users`).subscribe( snapshots => {\n      this.usersModel = [];\n      this.usersCount = snapshots.length;\n      snapshots.forEach( snapshot=> {\n        let userId = snapshot.$key;\n        let points = snapshot.$value;\n        \n        af.object(`users/${userId}`).subscribe( t=> {\n          t.pointsInRoom = points;\n          this.usersModel.push(t);\n        });\n      });\n    });\n\n    // Get the current room\n    af.object(`/rooms/${this.roomKey}`).subscribe( t=> {\n      this.roomName = t.roomName;\n      if(t.owner == authService.currentUser.displayName)\n          this.isOwner = true;\n      else {\n          this.roomService.updateUsersInRoom(this.roomKey);      \n      }\n\n          this.entryCode = t.entryCode;\n    })\n    \n    \n\n    // wait till the selector will select a category\n    let leaveLobby = af.object(`rooms/${this.roomKey}/isStarted`).subscribe( t=> {\n      console.log(\"is started changed to \" + t.$value);\n      if(t.$value) {\n          this.af.object(`rooms/${this.roomKey}/selector`).subscribe(  selector => {\n            console.log(\"selector changed to \" + selector.$value);\n            if(selector.$value == authService.currentUser.displayName) {\n           //   leaveLobby.unsubscribe();\n              this.dismissLoading();\n              this.navCtrl.push('ChooseCategoryPage', {\n                roomKey: this.roomKey,\n                spy: this.spyUser\n              });\n            }\n            else{\n              console.log(\"before isCategorySelected\");\n              af.object(`rooms/${this.roomKey}/isCategorySelected`).subscribe(catSelected => {\n                  console.log(\"isstarted is \" + t.$value);\n                console.log(\"selector is \" + selector.$value);\n                console.log(\"isCategorySelected to \" + catSelected.$value);\n              if(catSelected.$value) {\n                // if(this.selectorUser == authService.currentUser.$key) {\n                  // go to the loading game...\n                  console.log(\"gp to game page\");\n                  this.dismissLoading();\n                  this.navCtrl.push('GamePage', {\n                    roomKey: this.roomKey,\n                    //roundKey: this.selectorUser\n                }\n            );\n            }\n            });\n          }\n          // else {\n            \n            // }\n          // }\n        });\n      }\n    });\n  }\n\n  private dismissLoading(){\n    if(this.loader != null)\n      this.loader.dismiss();\n  }\n    \n  private raffleSpy(){ \n     let spyRandNumber = Math.floor(Math.random() * this.usersModel.length );\n    console.log(\"spy random number \" + spyRandNumber);\n    //  if(spyRandNumber >= this.usersModel.length)\n    //   spyRandNumber = this.usersModel.length - 1;\n     this.spyUser = this.usersModel[spyRandNumber].$key;\n     //this.af.object(`/rooms/${this.roomKey}/spy`).set(this.spyUser);\n     \n     this.roomService.setSpy(this.spyUser);\n  }\n\n  private raffleSelector(){ \n    \n    let spyRandNumber = Math.floor(Math.random() * this.usersModel.length);\n    // if(spyRandNumber >= this.usersModel.length)\n    //   spyRandNumber = this.usersModel.length - 1;\n    console.log(\"selector random number \" + spyRandNumber);\n\n    this.selectorUser = this.usersModel[spyRandNumber].displayName;\n    this.af.object(`/rooms/${this.roomKey}/selector`).set(this.selectorUser);\n  }\n  \n  presentLoading() {\n    this.loader = this.loadingCtrl.create({\n      content: \"Please wait...\",\n    });\n    this.loader.present();\n  }\n\n  startGame() {\n      this.presentLoading();\n      this.roomService.updateUsersInRoom(this.roomKey);\n\n      // raffle spy and category selector  \n      this.raffleSelector(); \n      this.raffleSpy();\n      console.log(\"new round\");\n      let round: RoundModel = {\n        categoryName: \"\",\n        selectorKey: this.selectorUser,\n        spyKey: this.spyUser,\n        roomKey: this.roomKey,\n        state: \"init\",\n        secret: 0\n      }\n\n      let roundKey = this.af.list(`rounds/`).push(round).key;\nconsole.log(\"new round key \" + roundKey);\n      // Add new room to the db\n       this.af.object(`rooms/${this.roomKey}/isStarted`).set(true);\n       this.af.object(`rooms/${this.roomKey}/usersCount`).set(this.usersCount);\n  \n  }\n\n  private getUserPoints(user: UserModel) {\n    this.af.object(`/rooms/${this.roomKey}/users/${user.$key}`).subscribe(t=> {\n      console.log(\"return value \" + t.$value);\n      return t.$value;\n    });\n  }\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/lobby/lobby.ts"],"sourceRoot":""}