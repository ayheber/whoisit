{"version":3,"sources":["../../src/pages/lobby/lobby.module.ts","../../src/pages/lobby/lobby.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { LobbyPage } from './lobby';\n\n@NgModule({\n  declarations: [\n    LobbyPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(LobbyPage),\n  ],\n})\nexport class LobbyPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/lobby/lobby.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { Observable } from 'rxjs/Observable';\nimport { UserModel } from '../../Models/user.model';\nimport { RoomModel } from '../../Models/room.model';\nimport { Platform } from 'ionic-angular';\nimport { AlertController } from 'ionic-angular';\n\n\n@IonicPage()\n@Component({\n  selector: 'page-lobby',\n  templateUrl: 'lobby.html',\n})\nexport class LobbyPage {\n\n  roomKey: string;\n  userName: string;\n  userItems: Observable<UserModel[]>;\n  roomsItems: Observable<RoomModel>;\n  users: Observable<UserModel[]>;\n  isOwner: Boolean;\n  selectorUser: string; \n  spyUser: string;\n  roomName: string;\n  entryCode: string;\n  usersInRoomKey: string;\n  usersModel: UserModel[] = [];\n  usersCount: number;\n\n  constructor(private platform: Platform, public navCtrl: NavController, public navParams: NavParams, \n              public af: AngularFireDatabase, private alertCtrl: AlertController) {\n\n\n    // Get thr paramters from the navigation controller\n    this.roomKey = this.navParams.get('roomKey');\n    this.userName = this.navParams.get('userName');\n\n    this.userItems = af.list(`rooms/${this.roomKey}/users`);\n\n    // get the users in the current room\n    af.list(`rooms/${this.roomKey}/users`).subscribe( snapshots => {\n      this.usersModel = [];\n      this.usersCount = snapshots.length;\n      snapshots.forEach( snapshot=> {\n        let userId = snapshot.$key;\n        af.object(`users/${userId}`).subscribe( t=> {\n          this.usersModel.push(t);\n        });\n      });\n    });\n\n\n    // Get the current room\n    af.object(`/rooms/${this.roomKey}`).subscribe( t=> {\n      this.roomName = t.roomName;\n      if(t.owner == this.userName)\n          this.isOwner = true;\n\n      this.entryCode = t.entryCode;\n    })\n\n    af.object(`rooms/${this.roomKey}/isStarted`).subscribe( t=> {\n      console.log(\"enter\");\n      if(t.$value) {\n\n          this.af.object(`rooms/${this.roomKey}/selector`).subscribe(  selector => {\n            if(selector.$value == this.userName) {\n              this.navCtrl.push('ChooseCategoryPage', {\n                roomKey: this.roomKey,\n                userName: this.userName\n              });\n            }\n            });\n          }\n          else {\n            af.object(`rooms/${this.roomKey}/isCategorySelected`).subscribe(catSelected => {\n              if(catSelected.$value) {\n                  // go to the loading game...\n                  this.navCtrl.push('GamePage', {\n                    roomKey: this.roomKey,\n                    userName: this.userName,\n                    selectorUser: this.selectorUser\n              }\n            );\n          }\n        });\n      }\n    });\n  }\n\n  \n    \n  private raffleSpy(){ \n     let spyRandNumber = Math.floor(Math.random() * (this.usersModel.length - 1) );\n\n     if(spyRandNumber >= this.usersModel.length)\n      spyRandNumber = this.usersModel.length - 1;\n     this.spyUser = this.usersModel[spyRandNumber].displayName;\n     this.af.object(`/rooms/${this.roomKey}/spy`).set(this.spyUser);\n  }\n\n  private raffleSelector(){ \n    let spyRandNumber = Math.floor(Math.random() * (this.usersModel.length - 1));\n    if(spyRandNumber >= this.usersModel.length)\n      spyRandNumber = this.usersModel.length - 1;\n\n    this.selectorUser = this.usersModel[spyRandNumber].displayName;\n    this.af.object(`/rooms/${this.roomKey}/selector`).set(this.selectorUser);\n  }\n\n  startGame() {\n \n      // raffle spy and category selector  \n      this.raffleSelector(); \n      this.raffleSpy();\n     \n\n      // Add new room to the db\n       this.af.object(`rooms/${this.roomKey}/isStarted`).set(true);\n       this.af.object(`rooms/${this.roomKey}/usersCount`).set(this.usersCount);\n  \n  }\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/lobby/lobby.ts"],"sourceRoot":""}