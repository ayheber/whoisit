{"version":3,"sources":["../../src/pages/end-game/end-game.module.ts","../../src/pages/end-game/end-game.ts"],"names":[],"mappings":"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","file":"5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { EndGamePage } from './end-game';\n\n@NgModule({\n  declarations: [\n    EndGamePage,\n  ],\n  imports: [\n    IonicPageModule.forChild(EndGamePage),\n  ],\n})\nexport class EndGamePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/end-game/end-game.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { AngularFireDatabase } from 'angularfire2/database';\nimport { UserModel } from '../../Models/user.model';\nimport { RoomsService } from '../../services/rooms.service';\nimport { AuthService } from '../../services/auth.service';\nimport { LoadingController } from 'ionic-angular';\n\n@IonicPage()\n@Component({\n  selector: 'page-end-game',\n  templateUrl: 'end-game.html',\n})\nexport class EndGamePage {\n\n  loader: any;\n  spyReadyToVote: boolean;\n  isTheSpy: boolean;\n  usersModel: UserModel[] = [];\n  roundKey: string;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams,  public af: AngularFireDatabase,\n              public roomService: RoomsService, public auth: AuthService, public loadingCtrl: LoadingController) {\n\n    // get the round key\n    this.roundKey = this.navParams.get('roundKey');\n    \n    // check if i am the spy\n    if(this.IamTheSpy()) {\n      this.presentLoading();\n      this.af.object(`rounds/${this.roomService.currentRoom.$key}/${this.roundKey}/spyState`).subscribe(spy =>{\n        \n        if(spy.$value == \"found\") {\n          this.dismissLoading();\n          // go to guess subject page\n          this.navCtrl.push(\"GuessPage\", { roundKey: this.roundKey });\n        }\n        else if(spy.$value == \"win\" || spy.$value == \"semi-win\" || spy.$value == \"lose\") {\n          this.dismissLoading();\n\n          this.addPointsToSpy(spy.$value);\n          // go to score page \n          this.navCtrl.push('ScorePage',  { roundKey: this.roundKey, spyState: spy.$value });\n        }\n      });\n    }\n    else {\n      // show the suspisious users\n      this.usersModel = this.loadUsers();\n\n      this.af.object(`rounds/${this.roomService.currentRoom.$key}/${this.roundKey}/isAllVoted`).subscribe(votes => {\n        // check if all users voted\n        if(votes.$value) {\n          this.af.object(`rounds/${this.roomService.currentRoom.$key}/${this.roundKey}/spyState`).subscribe(spy =>{\n            if(spy.$value == \"win\" || spy.$value == \"semi-win\" || spy.$value == \"lose\") {\n              this.dismissLoading();\n\n              this.addPointsToPlayer(spy.$value);\n              // go to score page \n              this.navCtrl.push('ScorePage',  { roundKey: this.roundKey, spyState: spy.$value});\n            }\n          });\n        }\n      });\n    }\n  }\n\n  private addPointsToPlayer(spyState: string) {\n    if(spyState == \"lose\") {\n      this.auth.currentUser.pointsInRoom += 3;\n      this.af.object(`/rooms/${this.roomService.currentRoom.$key}/users/${this.auth.currentUser.$key}`).set(this.auth.currentUser.pointsInRoom);\n    }\n  }\n\n  private addPointsToSpy(spyState: string) {\n    let points =0;\n    switch(spyState) {\n      case \"win\":\n        points = 5;\n        break;\n      case \"semi-win\":\n        points = 3;\n        break;\n    }\n\n    this.auth.currentUser.pointsInRoom += points;\n    this.af.object(`/rooms/${this.roomService.currentRoom.$key}/users/${this.auth.currentUser.$key}`).set(this.auth.currentUser.pointsInRoom);\n  }\n\n  private loadUsers() : UserModel[] {\n    return this.roomService.getUsersFromRoomButme(this.auth.currentUser);\n  }\n\n  private IamTheSpy() : boolean {\n    return this.auth.currentUser.$key == this.roomService.getSpy();\n  }\n\n  private presentLoading() {\n    this.loader = this.loadingCtrl.create({\n      content: \"Wait till all players vote...\",\n    });\n    this.loader.present();\n  }\n\n  private dismissLoading(){\n    if(this.loader != null)\n      this.loader.dismiss();\n  }\n\n  private voteUser(user: UserModel) {\n    let counter = 0;  \n    let subscribtion = this.af.object(`/rounds/${this.roomService.currentRoom.$key}/${this.roundKey}/votes/${user.$key}`).subscribe(u => {\n      counter = u.$value;\n      if(subscribtion != null)\n        subscribtion.unsubscribe();\n      counter++;\n      this.af.object(`/rounds/${this.roomService.currentRoom.$key}/${this.roundKey}/votes/${user.$key}`).set(counter);\n    });\n  }\n\n  public selectUser(user: UserModel) {\n    \n    // show loader\n    this.presentLoading();\n\n    // vote for the selected user\n    this.voteUser(user);\n    \n    // check if I selected right\n    if(user.$key == this.roomService.getSpy()) {\n      this.auth.currentUser.pointsInRoom += 1;\n\n      // add the current user to the win user list\n      this.af.list(`/rounds/${this.roomService.currentRoom.$key}/${this.roundKey}/wins/`).push(this.auth.currentUser.$key);\n    }\n    else {\n      // add the current user to the lose user list\n      this.af.list(`/rounds/${this.roomService.currentRoom.$key}/${this.roundKey}/loses/`).push(this.auth.currentUser.$key);\n    }\n\n    // in case you find the real spy you get 1 points\n    this.af.object(`/rooms/${this.roomService.currentRoom.$key}/users/${this.auth.currentUser.$key}`).set(this.auth.currentUser.pointsInRoom);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/end-game/end-game.ts"],"sourceRoot":""}